"use strict";(self.webpackChunkdoeks_website=self.webpackChunkdoeks_website||[]).push([[2107],{28453:(e,n,i)=>{i.d(n,{R:()=>t,x:()=>o});var s=i(96540);const r={},a=s.createContext(r);function t(e){const n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:t(e.components),s.createElement(a.Provider,{value:n},e.children)}},35762:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"infra/ai-ml/aibrix","title":"AIBrix on EKS","description":"Deployment of ML models on EKS requires access to GPUs or Neuron instances. If your deployment isn\'t working, it\u2019s often due to missing access to these resources. Also, some deployment patterns rely on Karpenter autoscaling and static node groups; if nodes aren\'t initializing, check the logs for Karpenter or Node groups to resolve the issue.","source":"@site/docs/infra/ai-ml/aibrix.md","sourceDirName":"infra/ai-ml","slug":"/infra/ai-ml/aibrix","permalink":"/ai-on-eks/docs/infra/ai-ml/aibrix","draft":false,"unlisted":false,"editUrl":"https://github.com/awslabs/ai-on-eks/blob/main/website/docs/infra/ai-ml/aibrix.md","tags":[],"version":"current","frontMatter":{"sidebar_label":"AIBrix on EKS"},"sidebar":"infra","previous":{"title":"JARK on EKS","permalink":"/ai-on-eks/docs/infra/ai-ml/jark"},"next":{"title":"EMR NVIDIA Spark-RAPIDS","permalink":"/ai-on-eks/docs/infra/ai-ml/emr-spark-rapids"}}');var r=i(74848),a=i(28453),t=i(42450);const o={sidebar_label:"AIBrix on EKS"},l="AIBrix on EKS",c={},d=[{value:"What is AIBrix?",id:"what-is-aibrix",level:3},{value:"Key Features and Benefits",id:"key-features-and-benefits",level:3},{value:"Prerequisites",id:"prerequisites",level:3},{value:"Deploy",id:"deploy",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",span:"span",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"aibrix-on-eks",children:"AIBrix on EKS"})}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsx)(n.p,{children:"Deployment of ML models on EKS requires access to GPUs or Neuron instances. If your deployment isn't working, it\u2019s often due to missing access to these resources. Also, some deployment patterns rely on Karpenter autoscaling and static node groups; if nodes aren't initializing, check the logs for Karpenter or Node groups to resolve the issue."})}),"\n",(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["These instructions only deploy the AIBrix cluster as a base. If you are looking to deploy specific models for inference or training, please refer to this ",(0,r.jsx)(n.a,{href:"https://awslabs.github.io/ai-on-eks/docs/blueprints",children:"AI"})," page for end-to-end instructions."]})}),"\n",(0,r.jsx)(n.h3,{id:"what-is-aibrix",children:"What is AIBrix?"}),"\n",(0,r.jsxs)(n.p,{children:["AIBrix is an open source initiative designed to provide essential building blocks to construct scalable GenAI inference infrastructure. AIBrix delivers a cloud-native solution optimized for deploying, managing, and scaling large language model (LLM) inference, tailored specifically to enterprise needs.\n",(0,r.jsx)(n.img,{src:"https://aibrix.readthedocs.io/latest/_images/aibrix-architecture-v1.jpeg",alt:"Alt text"})]}),"\n",(0,r.jsx)(n.h3,{id:"key-features-and-benefits",children:"Key Features and Benefits"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"LLM Gateway and Routing: Efficiently manage and direct traffic across multiple models and replicas."}),"\n",(0,r.jsx)(n.li,{children:"High-Density LoRA Management: Streamlined support for lightweight, low-rank adaptations of models."}),"\n",(0,r.jsx)(n.li,{children:"Distributed Inference: Scalable architecture to handle large workloads across multiple nodes."}),"\n",(0,r.jsx)(n.li,{children:"LLM App-Tailored Autoscaler: Dynamically scale inference resources based on real-time demand."}),"\n",(0,r.jsx)(n.li,{children:"Unified AI Runtime: A versatile sidecar enabling metric standardization, model downloading, and management."}),"\n",(0,r.jsx)(n.li,{children:"Heterogeneous-GPU Inference: Cost-effective SLO-driven LLM inference using heterogeneous GPUs."}),"\n",(0,r.jsx)(n.li,{children:"GPU Hardware Failure Detection: Proactive detection of GPU hardware issues."}),"\n"]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h2,{children:(0,r.jsx)(n.span,{children:"Deploying the Solution"})}),children:[(0,r.jsxs)(n.p,{children:["In this ",(0,r.jsx)(n.a,{href:"https://github.com/awslabs/ai-on-eks/tree/main/infra/aibrix/terraform",children:"example"}),", you will provision AIBrix on Amazon EKS."]}),(0,r.jsx)(n.h3,{id:"prerequisites",children:"Prerequisites"}),(0,r.jsx)(n.p,{children:"Ensure that you have installed the following tools on your machine."}),(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html",children:"aws cli"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://Kubernetes.io/docs/tasks/tools/",children:"kubectl"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://learn.hashicorp.com/tutorials/terraform/install-cli",children:"terraform"})}),"\n"]}),(0,r.jsx)(n.h3,{id:"deploy",children:"Deploy"}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"1. Clone the repository:"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/awslabs/ai-on-eks.git\n"})}),(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["If you are using profile for authentication\nset your ",(0,r.jsx)(n.code,{children:'export AWS_PROFILE="<PROFILE_name>"'})," to the desired profile name"]})}),(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"2. Review and customize configurations:"})}),(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Check available addons in ",(0,r.jsx)(n.code,{children:"infra/base/terraform/variables.tf"})]}),"\n",(0,r.jsxs)(n.li,{children:["Modify addon settings in ",(0,r.jsx)(n.code,{children:"infra/aibrix/terraform/blueprint.tfvars"})," as needed"]}),"\n",(0,r.jsxs)(n.li,{children:["Update the AWS region in ",(0,r.jsx)(n.code,{children:"blueprint.tfvars"})]}),"\n"]}),(0,r.jsxs)(n.p,{children:["Navigate into aibrix and run ",(0,r.jsx)(n.code,{children:"install.sh"})," script"]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ai-on-eks/infra/aibrix\n./install.sh\ncd ../..\n"})})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h3,{children:(0,r.jsx)(n.span,{children:"Verify Deployment"})}),children:[(0,r.jsx)(n.p,{children:"Update local kubeconfig so we can access kubernetes cluster"}),(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsx)(n.p,{children:"if you haven't set your AWS_REGION, use --region us-east-1 with the below command"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"aws eks  update-kubeconfig --name aibrix-on-eks\n"})}),(0,r.jsx)(n.p,{children:"First, let's verify that we have worker nodes running in the cluster."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get nodes\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"NAME                             STATUS   ROLES    AGE   VERSION\nip-100-64-139-184.ec2.internal   Ready    <none>   96m   v1.32.1-eks-5d632ec\nip-100-64-63-169.ec2.internal    Ready    <none>   96m   v1.32.1-eks-5d632ec\n"})}),(0,r.jsx)(n.p,{children:"Next, lets verify all the aibrix pods are running."}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n aibrix-system\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"NAME                                         READY   STATUS    RESTARTS   AGE\naibrix-controller-manager-5948f8f8b7-pqwjn   1/1     Running   0          83m\naibrix-gateway-plugins-5978d98445-mrgdt      1/1     Running   0          83m\naibrix-gpu-optimizer-64c978ddd8-944mp        1/1     Running   0          83m\naibrix-kuberay-operator-8b65d7cc4-xw6bd      1/1     Running   0          83m\naibrix-metadata-service-5499dc64b7-q6rfc     1/1     Running   0          83m\naibrix-redis-master-576767646c-lqdkk         1/1     Running   0          83m\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"kubectl get deployments -A\n"})}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"NAMESPACE              NAME                                                 READY   UP-TO-DATE   AVAILABLE   AGE\naibrix-system          aibrix-controller-manager                            1/1     1            1           11m\naibrix-system          aibrix-gateway-plugins                               1/1     1            1           11m\naibrix-system          aibrix-gpu-optimizer                                 1/1     1            1           11m\naibrix-system          aibrix-kuberay-operator                              1/1     1            1           11m\naibrix-system          aibrix-metadata-service                              1/1     1            1           10m\naibrix-system          aibrix-redis-master                                  1/1     1            1           11m\nenvoy-gateway-system   envoy-aibrix-system-aibrix-eg-903790dc               1/1     1            1           11m\nenvoy-gateway-system   envoy-gateway                                        1/1     1            1           12m\ningress-nginx          ingress-nginx-controller                             1/1     1            1           11m\nkarpenter              karpenter                                            2/2     2            2           99m\nkube-system            aws-load-balancer-controller                         2/2     2            2           12m\nkube-system            coredns                                              2/2     2            2           102m\nkube-system            ebs-csi-controller                                   2/2     2            2           80m\nkube-system            k8s-neuron-scheduler                                 1/1     1            1           12m\nkube-system            my-scheduler                                         1/1     1            1           12m\nnvidia-device-plugin   nvidia-device-plugin-node-feature-discovery-master   1/1     1            1           12m\n"})}),(0,r.jsx)(n.admonition,{type:"info",children:(0,r.jsxs)(n.p,{children:["Please refer to ",(0,r.jsx)(n.a,{href:"https://awslabs.github.io/ai-on-eks/docs/blueprints",children:"AIBrix Infrastructure"})," page for deploying AI models on EKS."]})})]}),"\n",(0,r.jsxs)(t.A,{header:(0,r.jsx)(n.h3,{children:(0,r.jsx)(n.span,{children:"Clean Up"})}),children:[(0,r.jsx)(n.admonition,{type:"caution",children:(0,r.jsx)(n.p,{children:"To avoid unwanted charges to your AWS account, delete all the AWS resources created during this deployment."})}),(0,r.jsxs)(n.p,{children:["This script will cleanup the environment using ",(0,r.jsx)(n.code,{children:"-target"})," option to ensure all the resources are deleted in correct order."]}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"cd ai-on-eks/infra/aibrix/terraform\n./cleanup.sh\n"})})]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},42450:(e,n,i)=>{i.d(n,{A:()=>m});var s=i(96540),r=i(5556),a=i.n(r),t=i(34164);const o="collapsibleContent_q3kw",l="header_QCEw",c="icon_PckA",d="content_qLC1",h="expanded_iGsi";var u=i(74848);function p({children:e,header:n}){const[i,r]=(0,s.useState)(!1);return(0,u.jsxs)("div",{className:o,children:[(0,u.jsxs)("div",{className:(0,t.A)(l,{[h]:i}),onClick:()=>{r(!i)},children:[n,(0,u.jsx)("span",{className:(0,t.A)(c,{[h]:i}),children:i?"\ud83d\udc47":"\ud83d\udc48"})]}),i&&(0,u.jsx)("div",{className:d,children:e})]})}p.propTypes={children:a().node.isRequired,header:a().node.isRequired};const m=p}}]);